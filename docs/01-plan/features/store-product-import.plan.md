# Plan: 네이버 스마트스토어 상품 자동 등록

## 개요
설정 메뉴에서 네이버 스토어 정보를 입력하면, 해당 스토어의 모든 상품을 스크래핑하여
'상품' 메뉴에 자동으로 등록하는 기능.

## 현재 상태 (As-Is)
- `User.naver_store_name`에 스토어명 저장 가능 (설정에서 수정)
- 상품은 수동으로 하나씩 등록 (이름, 판매가, 원가, 카테고리 등)
- 상품 생성 시 상품명으로 기본 키워드 자동 생성

## 목표 상태 (To-Be)
- 설정에서 네이버 스토어명 입력 → "상품 불러오기" 버튼 클릭
- 스토어의 전체 상품 목록을 자동으로 가져옴
- 가져온 상품을 미리보기 후 선택적으로 등록
- 등록 시 상품명, 판매가, 이미지 자동 채움 + 기본 키워드 자동 생성

## 상품 가져오기 방식 (2단계 전략)

### 1단계: 스마트스토어 페이지 스크래핑 (주 방식)
- 네이버 스마트스토어는 Next.js 기반 SPA
- `https://smartstore.naver.com/{storename}` 페이지의 `__NEXT_DATA__` 스크립트 태그에
  채널 번호(channelNo)와 초기 상품 데이터가 포함됨
- 또는 내부 API `https://smartstore.naver.com/i/v1/stores/{channelNo}/products` 활용
- 추출 데이터: 상품명, 판매가, 대표 이미지, 카테고리, 상품 ID

### 2단계: 쇼핑 검색 API 보완 (보조 방식)
- 기존 네이버 쇼핑 API(`sort=sim`)로 스토어명 키워드 검색
- `mallName` 필터로 내 스토어 상품만 추출
- 스크래핑에서 못 가져온 추가 정보(네이버 상품 ID 등) 보완

## 데이터 매핑

| 스크래핑 데이터 | Product 필드 | 비고 |
|---------------|-------------|------|
| 상품명 | `name` | 필수 |
| 판매가 | `selling_price` | 필수 |
| 대표 이미지 | `image_url` | 선택 |
| 카테고리 | `category` | 선택 (매핑 필요) |
| - | `cost_price` | 0으로 초기화, 사용자가 수동 입력 |

## 변경 범위 (백엔드)

### 1. 새 스크래퍼 모듈
- `backend/app/crawlers/store_scraper.py`
  - `fetch_store_products(store_name: str) -> list[StoreProduct]`
  - 스마트스토어 페이지 스크래핑 + 파싱
  - 에러 핸들링 (존재하지 않는 스토어, 네트워크 오류 등)

### 2. 새 스키마
- `backend/app/schemas/store_import.py`
  - `StoreProduct`: 스크래핑 결과 아이템 (name, price, image_url, category)
  - `StoreImportRequest`: 등록할 상품 선택 목록
  - `StoreImportResult`: 등록 결과 (성공/실패/중복 건수)

### 3. 새 API 엔드포인트
- `GET /api/v1/users/{user_id}/store/products` — 스토어 상품 미리보기 (스크래핑 실행)
- `POST /api/v1/users/{user_id}/store/import` — 선택한 상품 일괄 등록

### 4. 상품 등록 로직
- 중복 체크: 같은 이름의 상품이 이미 등록되어 있으면 스킵
- `cost_price`: 0으로 초기화 (사용자가 나중에 수동 입력)
- 각 상품마다 기본 키워드(상품명) 자동 생성 (기존 로직 활용)

## 변경 범위 (프론트엔드, Codex 담당)
- 설정 페이지에 "상품 불러오기" 버튼 추가
- 미리보기 모달: 체크박스로 등록할 상품 선택
- 등록 결과 표시 (N개 등록, N개 중복 스킵)

## 리스크
- **스크래핑 불안정성**: 네이버 페이지 구조 변경 시 파싱 실패 가능
  → 에러 핸들링 철저히 + 파싱 실패 시 명확한 에러 메시지
- **대량 상품**: 상품이 수백 개인 경우 페이지네이션 처리 필요
- **Rate Limiting**: 스마트스토어 서버의 요청 제한 가능성
  → 적절한 딜레이 + 재시도 로직

## 구현 순서
1. 스마트스토어 페이지 구조 분석 (스크래핑 가능성 검증)
2. store_scraper.py 구현
3. 스키마 + API 엔드포인트 구현
4. 상품 일괄 등록 로직 구현
5. CLAUDE.md API 명세 업데이트
6. 프론트엔드 프롬프트 작성 (Codex용)
